var emailbody = "";var default_linktext = "Click here to email results to Matt";var linktext = default_linktext;var pathtomaxfolder = "";function maxfolder() {	if (arguments.length == 0) {		post("Error: no arguments to maxfolder message!");	} else {		pathtomaxfolder = arguments[0];	}}	function clear() {	emailbody = "";}function llll() {	post('llll\n');}function setlinktext() {	if (arguments.length == 0) {		linktext = default_linktext;	} else {		linktext = "";		for (i=0; i < arguments.length; ++i) {			linktext = linktext + arguments[i] + " ";		}	}}	function apppath() {		post(max.apppath+"\n");}function next_html_filename() {	for (i=1; i<1000; ++i) {		filename = "sendemail-" + i + ".html";//		post(filename + "\n");		var f = new File(":" + filename, "read");		if (f.isopen) {			// Yes, there was a file with that name			f.close();		} else {			post("Next filename: " + filename + "\n");			return filename;		}	}	post("There seem to be a lot of HTML email files in your Max folder!");	return("sendemail-n.html");}function done() {  if (emailbody.length == 0) {    post("text2email: text to be sent is still empty; can't send.\n");    return;  }//	post(emailbody);//	post();//	window.open("mailto:matt@ccrma.stanford.edu?subject=listening test data&body= "+emailbody, 'email');//	max.launchbrowser("mailto:matt@ccrma.stanford.edu?subject=listening test data&body= "+emailbody);//	post("Email has length " + emailbody.length);//	post("Email: " + emailbody + "\n");	var escape1 = escape(emailbody);	var escaped = escape1.replace(/%0A/g,"%0A\n");//	post("escaped length is " + escaped.length);//	post("Escaped: " + escaped + "\n");//	var filename = "sendemail.html";	var filename = next_html_filename();  var f = new File(":"+filename,"write","HTML");   if (f.isopen) {    post("writing escaped text to file...\n");        // Header    f.writestring('<HTML><BODY><H1>');    f.writestring('<A HREF="mailto:matt@ccrma.stanford.edu?subject=listening test data&body=');    // One line at a time...    var a, z;    a = 0;    z = 0;    while (z < escaped.length) {      // post("char: " + escaped[z] + "\n");      if (escaped[z] == "\n") {	var line = escaped.slice(a,z);	// post("Writing line: " + line + "\n");	f.writestring(line); //writes a string	a = z;      }       ++z;    }        if (a != escaped.length-1) {      var line = escaped.slice(a, escaped.length);      // post("Writing last line: " + line + "\n");      f.writestring(line); //writes a string    }        f.writestring('"> '+linktext+' </a></H1>');        // Andy's form method    f.writestring("<hr>\n");    f.writestring("If that doesn't work (which is likely on Windows), try this instead:\n");    f.writestring('<form action="mailto:matt@cnmat.berkeley.edu?subject=listening test data" method="post"\n');    f.writestring('<textarea name="\n');    f.writestring(emailbody);    f.writestring('">\n');    f.writestring('</textarea> <input type="submit"></form>\n');    f.writestring("<hr>\n");    f.writestring("<p>If neither of the above work, your last resort is to open your\n");    f.writestring("usual mail program manually and send this HTML file as an attachment.\n");    f.writestring("This file is named " + filename + " and it's located in your \n");    f.writestring("Max/MSP application folder:</p>\n");    f.writestring("<ul><li> Windows: /Program Files/Cycling '74/MaxMSP 4.6/</li>\n");    f.writestring("<li> Macintosh: /Applications/MaxMSP 4.6/ </li></ul>\n");    f.writestring("<p>Use whichever of these three methods works best for you.</p>\n");    f.writestring('</BODY></HTML>\n');    f.close();    // var fileURL = "file:" + escape(pathtomaxfolder + f.filename);    var fileURLraw = "file:///" + (pathtomaxfolder + f.filename);    var fileURL = fileURLraw.replace(/ /g, "%20");    post("Opening " + fileURL + "\n");        max.launchbrowser(fileURL);  } else {    post("could not create file: " + s + "\n");  }  emailbody = "";}function openurl() {	if (arguments.length == 0) {		post("Can't open nothing");	} else {		max.launchbrowser(arguments[0]);	}}function set() {	// This is what comes out of Text when you send "dump"	for (i=0; i< arguments.length; ++i) {		emailbody = emailbody + arguments[i] + " ";	}	emailbody = emailbody + "\n";}function foo() {	max.launchbrowser("file:/tmp/foo.txt");}